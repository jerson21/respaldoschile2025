<!DOCTYPE html>
<html lang="es">

<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Comprar</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: FlexStart - v1.4.0
  * Template URL: https://bootstrapmade.com/flexstart-bootstrap-startup-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">    



<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
 <style type="text/css">

 <style type="text/css">

#imagenes img {
    -webkit-transition: all 1s ease; /* Safari and Chrome */
    -moz-transition: all 1s ease; /* Firefox */
    -ms-transition: all 1s ease; /* IE 9 */
    -o-transition: all 1s ease; /* Opera */
    transition: all 1s ease;
}

#imagenes:hover img {
    -webkit-transform:scale(1.5); /* Safari and Chrome */
    -moz-transform:scale(1.5); /* Firefox */
    -ms-transform:scale(1.5); /* IE 9 */
    -o-transform:scale(1.5); /* Opera */
     transform:scale(1.5);


}

.timeline {
  list-style-type: none;
  display: flex;
  align-items: center;
  justify-content: center;
  
}

.li {
  transition: all 200ms ease-in;
}

.timestamp {
  margin-bottom: 1rem;
  padding: 0px 0.2rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  font-weight: 2rem;
}

.status {
  padding: 0px 2rem;
  display: flex;
  justify-content: center;
  border-top: 2px solid #D6DCE0;
  position: relative;
  transition: all 200ms ease-in;
}
.status h4 {
  font-weight: 1rem;

  font-size: 1.5rem;
}
.status:before {
  content: "";
  width: 2rem;
  height: 2rem;
  background-color: white;
  border-radius: 2rem;
  border: 1px solid #ddd;
  position: absolute;
  top: -10px;
  left: 42%;
  transition: all 200ms ease-in;
}
.li.enproceso .status {
  border-top: 2px solid #1273FE;

}
.li.enproceso .status:before {
  background-color: #1273FE;
  border: none;
  transition: all 200ms ease-in;
}
.li.enproceso .status h4 {
  font-size: 1.5rem;
  color: #1273FE;
}

.li.complete .status {
  border-top: 2px solid #66DC71;

}
.li.complete .status:before {
  background-color: #66DC71;
  border: none;
  transition: all 200ms ease-in;
}
.li.complete .status h4 {
  font-size: 1.5rem;
  color: #66DC71;
}

@media (min-width: 200px) and (max-width: 600px) {
  .timeline {
    zoom: 0.7;
    -moz-transform: scale(0.9);
    list-style-type: none;
  display: flex;
  align-items: center;
  justify-content: center;
  
}

.li {
  transition: all 200ms ease-in;
}

.timestamp {
  margin-bottom: 1rem;
  padding: 0px 0.2rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  font-weight: 2rem;
}

.status {
  padding: 0px 1rem;
  display: flex;
  justify-content: center;
  border-top: 2px solid #D6DCE0;
  position: relative;
  transition: all 200ms ease-in;
}
.status h4 {
  font-weight: 1rem;

  font-size: 1.5rem;
}
.status:before {
  content: "";
  width: 1.5rem;
  height: 1.5rem;
  background-color: white;
  border-radius: 2rem;
  border: 1px solid #ddd;
  position: absolute;
  top: -9px;
  left: 42%;
  transition: all 200ms ease-in;
}
.li.enproceso .status {
  border-top: 2px solid #1273FE;

}
.li.enproceso .status:before {
  background-color: #1273FE;
  border: none;
  transition: all 200ms ease-in;
}
.li.enproceso .status h4 {
  font-size: 1.5rem;
  color: #1273FE;
}

.li.complete .status {
  border-top: 2px solid #66DC71;

}
.li.complete .status:before {
  background-color: #66DC71;
  border: none;
  transition: all 200ms ease-in;
}
.li.complete .status h4 {
  font-size: 1.5rem;
  color: #66DC71;
}
}


button {
  position: absolute;
  width: 100px;
  min-width: 100px;
  padding: 20px;
  margin: 20px;
  font-family: "Titillium Web", sans serif;
  border: none;
  color: white;
  font-size: 16px;
  text-align: center;
}


</style>

</head>

<body>

<link href="https://fonts.googleapis.com/css?family=Titillium+Web:200,100,300,600,700" rel="stylesheet" type="text/css">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top">
    <div class="container-fluid container-xl d-flex align-items-center justify-content-between">

      <a href="index.html" class="logo d-flex align-items-center">
        <img src="assets/img/logo.png" alt="">
        <span>Respaldos Chile</span>
      </a>

      <nav id="navbar" class="navbar">
        <ul>
          <li><a class="nav-link scrollto active" href="index.html">Inicio</a></li>
          
          
          <li><a class="nav-link scrollto" href="index.html#portfolio">Catalogo</a></li>         
          
          <li class="dropdown"><a href="#"><span>Productos</span> <i class="bi bi-chevron-down"></i></a>
            <ul>
              
              <li class="dropdown"><a href="#"><span>Respaldos de Cama</span> <i class="bi bi-chevron-right"></i></a>
                <ul>
                  <li><a href="portfolio-details.php?id=1">Botoné 2 corridas de botones.</a></li><!-- puede ser una imagen -->
                  <li><a href="portfolio-details.php?id=3">Botoné 3 corridas de botones.</a></li>
                  <li><a href="portfolio-details.php?id=6">Capitoné</a></li>
                  <li><a href="portfolio-details.php?id=2">Lisos</a></li>
                  <li><a href="portfolio-details.php?id=5">Lisos con costuras.</a></li>
                </ul>
              </li>
              <li><a href="portfolio-details.php?id=4">Bases de Cama</a></li>
              <li><a href="#">Colchones</a></li>
              <!--<li><a href="#">Drop Down 4</a></li> -->
            </ul>
          </li>
          <li><a class="nav-link scrollto" href="index.html#contact">Contacto</a></li>
          <li><a class="getstarted scrollto" href="seguimientocompra.php">Seguimiento de mi compra</a></li>
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->

    </div>

  </header><!-- End Header -->

  <main id="main" style="background-color: #EEEEEE;">

    <!-- ======= Breadcrumbs ======= -->
    <section class="breadcrumbs">
      <div class="container">

        <ol>
          <li><a href="index.html">Inicio</a></li>
          <li>Clientes</li>
        </ol>
        <h2>Seguimiento de Compras</h2>

      </div>
    </section><!-- End Breadcrumbs -->

    <!-- ======= Portfolio Details Section ======= -->
   

      
</br></br>
      <div class="container" style="width: 95%; background-color: white; padding:1rem; border-radius: 1rem;">
<?php

// incluimos el fichero de conexión
$conn=mysqli_connect('localhost','cre61650_respaldos21','respaldos21/','cre61650_agenda');

$BD_SERVIDOR = "localhost";
$BD_USUARIO ="cre61650_respaldos21";
$BD_PASSWORD = "respaldos21/";
$BD_NOMBRE = "cre61650_agenda";
$contador = 0;
$mysqli = new mysqli($BD_SERVIDOR, $BD_USUARIO, $BD_PASSWORD, $BD_NOMBRE);
$conn->set_charset("utf8");
 $rut = $_POST["rut"];

$strsql = "SELECT * FROM clientes where rut = '$rut'";
    $rs = mysqli_query($conn, $strsql);
    $total_rows = $rs->num_rows;
    $data = array();   
while( $row=mysqli_fetch_array($rs) ) {
$rut_cliente = $row['rut'];
$nombre = $row['nombre'];
$direccion = $row['direccion']." ".$row['numero']." ".$row['comuna'];
$telefono = $row['telefono'];
$numero = $row['numero'];
$dpto = $row['dpto'];
$correo = $row['correo'];
$instagram = $row['instagram'];

$contador++;
}
if($contador == 0){
 
  echo "<script>window.history.back(alert('No existen datos, estamos ingresando todos los pedidos al nuevo sistema.'));</script>"; exit;
}


  $sql = "SELECT * FROM pedidos where rut_cliente = '$rut'";
$query = $conn->query($sql);
$row3 = $query->fetch_assoc(); 
$num_orden = $row3['num_orden'];
$ruta_asignada = $row3['ruta_asignada'];
?>
<div style="font-weight:bold; text-align: center;"> Datos de Cliente</div>
<form  name="formular" id="formular"  accept-charset="utf-8" method="post" action="">
  <div class="col-md-4" style="padding-bottom:  2rem;">
    <label >Rut</label> <input type="text" class="form-control" value="<?php echo $rut_cliente; ?>" readonly="">
    <label>Nombre</label> <input type="text" class="form-control" value="<?php echo $nombre; ?>" readonly="">
  <label>Direccion</label> <input type="text" class="form-control" value="<?php echo $direccion; ?>" readonly="">
  <label>Telefono</label> <input type="text" class="form-control" value="<?php echo $telefono; ?>" readonly="">
  <label>Correo Electronico</label> <input type="text" class="form-control" value="<?php echo $correo; ?>" readonly="">
  <?php 
  $strsql = "SELECT * FROM rutas where id = $ruta_asignada";
    $rs = mysqli_query($conn, $strsql);
    $total_rows = $rs->num_rows;
    $data = array();   
while( $row=mysqli_fetch_array($rs) ) {
   $fecha = $row['fecha'];
}
if($fecha != ""){
setlocale(LC_TIME, 'es_CO.UTF-8');

  $fecha = strftime("%A, %d de %B de %Y", strtotime($fecha));}
  else{
    $fecha = "Por asignar";
  }
  

?>
  <label>Fecha de entrega</label> <input type="text" class="form-control" value="<?php echo $fecha; ?>" readonly="">
</div>
</div> <!-- fin container de datos clientes -->
<div class="container" style="width: 100%; background-color: white; padding:1rem; border-radius: 1rem; margin-top:1rem;">
  <div style="font-weight:bold; text-align: center;"> Estado</div>
<div class="col-md-12" style="width: 100nv;   height: 100%;  display: flex;  margin: 0 auto;  font-family: 'Titillium Web', sans serif;  color: #758D96;"> 

  <ul class="timeline" id="timeline" style="margin-top: 2rem; margin: 0 auto; padding: 1rem; border: 1px solid #000; border-radius: 1rem; width:100%; text-align: center;">
  <li class="li complete">
    <div class="timestamp">
       <?php $sql = "SELECT estado FROM orden where num_orden = $num_orden";
$query = $conn->query($sql); 
$row4 = $query->fetch_assoc(); 
$estado = $row4["estado"];?>
      <span class="author">Ingreso Solicitud</span>
     <!-- <span class="date">09/01/2021<span> -->
    </div>
    <div class="status">
      <h4> Completado </h4>
    </div>
  </li>
  <?php if($estado >= 1){ 
echo '<li class="li complete">';
$compraaprobada = 'Aprobada';
}else{
  echo '<li class="li">';
  $compraaprobada = 'Esperando Confirmación';
}

    ?>
  
    <div class="timestamp">
      <span class="author">Compra Aprobada</span>
  
    </div>
    <div class="status">
      <h4> <?php echo $compraaprobada; ?> </h4>
    </div>
  </li>
  <?php if($estado == 2){ 
echo '<li class="li enproceso">';
$fabricacion = 'En Proceso';
}elseif($estado >= 3){
  echo '<li class="li complete">';
  $fabricacion = 'Listo';
}else{
echo '<li class="li">';
  $fabricacion = 'En espera';
}
?>
  
    <div class="timestamp">
      <span class="author">Fabricación</span>
      
    </div>
    <div class="status">
      <h4> <?php echo $fabricacion; ?> </h4>
    </div>
  </li>
  <?php if($estado == 3){
  echo '<li class="li enproceso">';
  $despacho = $fecha;
}
elseif($estado == 4){
  echo '<li class="li enproceso">';
  $despacho = 'En Ruta a domicilio';
}
elseif($estado == 5){
  echo '<li class="li complete">';
  $despacho = 'Entregado';
}
else{
echo '<li class="li">';
  $despacho = '-';
} 

?>
  
    <div class="timestamp">
      <span class="author">Despacho</span>
      
    </div>
    <div class="status">
      <h4> <?php echo $despacho; ?> </h4>
    </div>
  </li>
 </ul>

</div>
</div> <!-- fin div timeline -->
<div class="container" style="width: 95%; background-color: white; padding:1rem; border-radius: 1rem; margin-top:1rem;">
<div class="col-md-12" style="padding-bottom:  2rem; display: block;
       overflow-x: auto;">
      
       <div style="font-weight:bold; text-align: center;"> Listado de Productos Pedido Nº <?php echo $num_orden; ?> </div>
 

</form>
 <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
      <script id="rendered-js" >
var completes = document.querySelectorAll(".complete");
var toggleButton = document.getElementById("toggleButton");


function toggleComplete() {
  var lastComplete = completes[completes.length - 1];
  lastComplete.classList.toggle('complete');
}

toggleButton.onclick = toggleComplete;
//# sourceURL=pen.js
    </script>

<?php

$sql = "SELECT * FROM pedidos JOIN orden on pedidos.num_orden = orden.num_orden where pedidos.num_orden = $num_orden";
$query = $conn->query($sql);

// extraemos la informacion de la tabla clientes..

if ($query->num_rows > 0) {
$output = "";
$output .= "<table style='' class='table table-hover table-striped table-bordered' >
<thead>
<tr style='background:white;'>
<th style='width:2rem;'>Cod</th>

<th style='width:20rem;'>Producto</th>
<th style='width:8rem;'>Tamaño</th>
<th style='width:8rem;'>Material</th>
<th style='width:10rem;'>Color</th>
<th style='width:8rem;'>Altura Base</th>



<th  style='width:8rem;'>Estado</th>

</tr>
</thead>";
while ($row = $query->fetch_assoc()) {
  $cod = $row['color'];
  $resultado = $mysqli->query("SELECT color FROM colores WHERE color = '$cod'");
$fila = $resultado->fetch_assoc();

$modelo = ucfirst($row['modelo']);
if($row['modelo'] == "Botone 3 corridas de botones")
{
  $modelo = "Botone 3 corridas de botones";
}
$color = $fila['color'];
$color = ucfirst(strtolower($color));
$tipotela = ucwords($row['tipotela']);

if($row['estadopedido'] > 2){
  $estadofabricacion = "Listo";
}
else{
  $estadofabricacion = "En Proceso";
}

$output .= "<tbody>

<tr>
<td>{$row['id']}</td>

<td>{$modelo}</td>
<td>{$row['plazas']}</td>
<td>{$tipotela}</td>
<td>{$color}</td>
<td>{$row['alturabase']}</td>



<td>  $estadofabricacion </td>

</tr>
</tbody>";
}
$output .="</table>";

echo $output;
echo "</div>
</div>";
}else{
echo "<h5>Ningún registro fue encontrado</h5>";
}

?>
       
        

      

<div class="modal fade" id="exampleModalCenter"  tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog  modal-dialog-centered modal-xl" role="document" style=" width: 900rem;">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" style="font-weight: bold;" id="exampleModalLongTitle">Titulo del Modal</h5>
       
      </div>
      <div class="modal-body">
        <?php
        $sql="SELECT *  from rutas";

  $result=mysqli_query($conn,$sql);


  $cadena="<label>Rutas Disponibles </label> 
      <select  id='rutas' name='rutas'>";

  while ($ver=mysqli_fetch_row($result)) {
    $fecha = $ver[1];
    $idruta = $ver[0];
    $fecha = fechaCastellano($fecha);

    $sql2="SELECT comuna from pedidos where ruta_asignada = $idruta";

  $result2=mysqli_query($conn,$sql2);


 $comuna = "";

  while ($ver2=mysqli_fetch_row($result2)) {
    $comuna .= ', '.$ver2[0];
    
  }

    $cadena=$cadena.'<option value='.$ver[0].'>Día '.$fecha.' '.$comuna.'</option>';
  }

  
  echo  $cadena."</select>";

  function fechaCastellano ($fecha) {
  $fecha = substr($fecha, 0, 10);
  $numeroDia = date('d', strtotime($fecha));
  $dia = date('l', strtotime($fecha));
  $mes = date('F', strtotime($fecha));
  $anio = date('Y', strtotime($fecha));
  $dias_ES = array("Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado", "Domingo");
  $dias_EN = array("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday");
  $nombredia = str_replace($dias_EN, $dias_ES, $dia);
$meses_ES = array("Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre");
  $meses_EN = array("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December");
  $nombreMes = str_replace($meses_EN, $meses_ES, $mes);
  return $nombredia." ".$numeroDia." de ".$nombreMes." de ".$anio;
}
        ?>
      </div>
      <div id="tablarutas">asdasd <br>
      <input type="input" class="form-control" id="inputName" value="" placeholder="Enter your name"/></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
        <button type="button" id="guardar" name="guardar" class="btn btn-primary"  data-target="#exampleModalCenter" >Guardar</button>
      </div>
    </div>
  </div>
</div>






  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">

    

        

  <div class="container">
      <div class="copyright">
        &copy; Copyright <strong><span>Respaldos Chile 2021</span></strong>. Todos los derechos reservados.
      </div>
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/flexstart-bootstrap-startup-template/ -->
        <!-- Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a> -->
      </div>
    </div>
  </footer><!-- End Footer -->
 

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
 
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

</body>



</html>